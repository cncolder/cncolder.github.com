<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ViTarn Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="ViTarn Blog">
<meta property="og:url" content="http://blog.vitarn.com/page/4/index.html">
<meta property="og:site_name" content="ViTarn Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ViTarn Blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="ViTarn Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ViTarn Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/googlessl">GoogleSSL</a>
        
          <a class="main-nav-link" href="/lookuptower">LookupTower</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://blog.vitarn.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-concat-my-name-use-ruby-magic" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/06/16/concat-my-name-use-ruby-magic/" class="article-date">
  <time datetime="2009-06-15T16:00:00.000Z" itemprop="datePublished">2009-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/16/concat-my-name-use-ruby-magic/">Concat My Name Use Ruby Magic</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Print "colder"</span></span><br><span class="line">(<span class="number">_</span>=%!%!&lt;&lt;(?<span class="comment">#+?@))&amp;&amp;_%(?#+?@)+_%(?/+?@)+_%(?,+?@)+_%(?$+?@)+_%(?%+?@)+_%(?#+?%+?*)</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/06/16/concat-my-name-use-ruby-magic/" data-id="ci9p9dvx7002n47jj0q0ksmme" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/06/16/concat-my-name-use-ruby-magic/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-the-night-of-apple" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/06/09/the-night-of-apple/" class="article-date">
  <time datetime="2009-06-08T16:00:00.000Z" itemprop="datePublished">2009-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/09/the-night-of-apple/">苹果之夜</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>6月9日清晨, 打开Google Reader, 满世界的苹果新闻, 噢~ 原来昨晚是苹果之夜(WWDC2009).</p>
<p>我不是什么果粉, 我只是凭直觉选择自己需要的东西, 浏览一下看看都有什么:</p>
<ul>
<li>iPhone 3GS<ul>
<li>S代表速度(speed)</li>
<li>摄像头强了</li>
<li>罗盘是真的</li>
<li>其次还有一大堆本来就该有的功能终于有了</li>
<li>价格: 16G - 199美刀, 32G - 299美刀. 8G不带S - 99美刀.</li>
</ul>
</li>
<li>Snow Leopard<ul>
<li>9月上市</li>
<li>体积减小6G, PPC的末日!</li>
<li>发布消息之后购买的Mac可以加88元升级系统.</li>
</ul>
</li>
<li>MacBook<ul>
<li>13吋铝本纳入Pro家族了, MacBook家族只剩下小白了, 小白~ 你要挺住~.</li>
<li>另添新丁15吋, 再加上原有的17吋, 目前全系列共有三种规格.</li>
<li>提高了电池续航</li>
<li>13吋增加了SD卡插槽…</li>
<li>Air家族价格集体缩水, 13吋的Air官方标价不到12K</li>
</ul>
</li>
<li>Safari<ul>
<li>据说是蛮强的</li>
<li>已经下载好了, 准备更新.</li>
<li>这篇文章是在Sarafi3下面发布的最后一篇了</li>
<li>升级</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/06/09/the-night-of-apple/" data-id="ci9p9dvxe002p47jj3pr5v9uz" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/06/09/the-night-of-apple/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apple/">Apple</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Safari/">Safari</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iPhone/">iPhone</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-adobe-flash-builder-4-beta1-for-mac" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/06/04/adobe-flash-builder-4-beta1-for-mac/" class="article-date">
  <time datetime="2009-06-03T16:00:00.000Z" itemprop="datePublished">2009-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/06/04/adobe-flash-builder-4-beta1-for-mac/">Adobe Flash Builder 4 Beta1 for Mac</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>六一那天放假应该不包括你吧, 那你一定不会错过 Adobe 发布 <a href="http://labs.adobe.com/technologies/flashbuilder4" target="_blank" rel="external">Flash Builder 4 beta1</a> 的利好新闻.</p>
<p>对于 Adobe 的官网, 五年以来一直给我留下深刻印象, 访问和下载的速度因为实在是太慢了, 虽然这五年间我已经从 Windows 变成 Mac, 从网通变成电信, 速度仍然没有起色.</p>
<p>关于 Flash Builder 的介绍显得有点多余, 因为如果你既然了解这个名字, 就一定知道怎么去用, 若是和我一样面对着 Mac 版的下载链接无奈的话, 试试下面这个地址:</p>
<p><a href="http://download2us.softpedia.com/dl/bb3c80147c3cefb7ef42957d3de56cec/4a273f5a/400057421/mac/Developer-Tools/flashbuilder4_b1_mac_060109.dmg" target="_blank" rel="external">flashbuilder4_b1_mac_060109.dmg</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/06/04/adobe-flash-builder-4-beta1-for-mac/" data-id="ci9p9dvxi002u47jjqdcwno14" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/06/04/adobe-flash-builder-4-beta1-for-mac/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flash/">Flash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/">Mac</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-decimal-ip-address" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/29/decimal-ip-address/" class="article-date">
  <time datetime="2009-05-28T16:00:00.000Z" itemprop="datePublished">2009-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/29/decimal-ip-address/">十进制 IP 地址</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>“十进制网址”这个词汇, 从诞生之日起就一直摆脱不掉一双引号, 关于这项牛X技术的文章请自行搜索.</p>
<p>具体的实现过程是这样的:</p>
<p>今有IP一枚: <em>10.1.2.3</em></p>
<p>则”十进制”格式的计算方法是:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span>*<span class="number">256</span>^<span class="number">3</span> + <span class="number">1</span>*<span class="number">256</span>^<span class="number">2</span> + <span class="number">2</span>*<span class="number">256</span>^<span class="number">1</span> + <span class="number">3</span>*<span class="number">256</span>^<span class="number">0</span></span><br><span class="line"><span class="number">167772160</span> + <span class="number">65535</span> + <span class="number">512</span> + <span class="number">3</span></span><br><span class="line"><span class="number">167838211</span></span><br></pre></td></tr></table></figure>
<p>逆向运算就是求商取余的过程.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> </span>decimal_ip_transform(ip)</span><br><span class="line">  powers_256 = (<span class="number">0</span>..<span class="number">3</span>).map &#123; |p|</span><br><span class="line">      <span class="number">256</span>**p</span><br><span class="line">  &#125;.reverse.freeze</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">case</span> ip</span><br><span class="line">  <span class="keyword">when</span> <span class="constant">Integer</span></span><br><span class="line">    powers_256.map &#123; |p|</span><br><span class="line">        [ip/p, ip %= p].first.to_s</span><br><span class="line">    &#125;.join(<span class="string">"."</span>)</span><br><span class="line">  <span class="keyword">when</span> <span class="constant">String</span></span><br><span class="line">    ip.scan(<span class="regexp">/\d&#123;1,3&#125;/</span>).zip(powers_256).inject(<span class="number">0</span>) &#123; |acc,a|</span><br><span class="line">        acc + a.first.to_i*a.last</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="可是这有什么用呢?_申请科研经费?">可是这有什么用呢? 申请科研经费?</h3><h2 id="Stop!_如果你这样想,_请你离开,_谢谢配合!">Stop! 如果你这样想, 请你离开, 谢谢配合!</h2><p>====================虚荣与务实的分隔线====================</p>
<p>务实派请往下看:</p>
<p>最近有个需求是用IP地址来区分一种终端设备的地理位置, 需要在数据库里记录IP地址对应的设备信息.</p>
<p>直接将”192.168.0.3”这样的字符串保存起来, 读取时不太容易匹配, 如果加长到”192.168.000.003”的话就能支持排序的过滤等操作, 可是体积也变大了了.</p>
<p>如何缩小这一列的宽度的同时实现需求呢? 上文提到的方法值得一试, 把字符串转化成整数保存, 范围在 0 到 4294967295 之间, 而且是线性增长的, 相邻的IP字符串转化的数字也是相邻的, 查找 BETWEEN 167772160 AND 167772160+255 肯定要比查找 LIKE “10.0.0.%” 快的多吧!</p>
<p>PS: 文中除了代码是真的, 其它全是假的, 例子也是假的, 只是为了记录突然冒出来的怪异想法, 关于文章题目请勿深究.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/05/29/decimal-ip-address/" data-id="ci9p9dvxm002y47jjlj8zgx0o" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/05/29/decimal-ip-address/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-f-may-2009-ctp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/20/f-may-2009-ctp/" class="article-date">
  <time datetime="2009-05-19T16:00:00.000Z" itemprop="datePublished">2009-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/20/f-may-2009-ctp/">F# May 2009 CTP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.microsoft.com/visualstudio/en-us/products/2010/default.mspx" target="_blank" rel="external">VS2010 beta1</a>已经可以下载, F# 内置其中, 项目模板仍然只有3个(程序, 库, 教程).</p>
<p><a href="http://download.microsoft.com/download/F/7/4/F74A3170-261C-4E8F-B1A8-2E352C61A89B/InstallFSharp.msi" target="_blank" rel="external">VS2008 插件</a>同时发布.</p>
<p>或者直接下载<a href="http://download.microsoft.com/download/F/7/4/F74A3170-261C-4E8F-B1A8-2E352C61A89B/fsharp.zip" target="_blank" rel="external">源代码</a>.</p>
<p>貌似这段时间 F#项目组的工作也只是与VS2010整合, “看的见”的变化应该是体现在数据可视化设计方便, 至于许多人关心的若干设计器F#版, 我认为没有很正常, 以后也不会有.</p>
<p>语法上的改变详见<a href="http://msdn.microsoft.com/en-us/library/dd867745.aspx" target="_blank" rel="external">MSDN</a>.</p>
<p>对于新的VS2010, <a href="http://www.google.cn/search?q=VS2010+速度慢+site:cnblogs.com" target="_blank" rel="external">普遍反映速度慢了许多</a>, WPF实现的界面, 果然不出所料.</p>
<p>由于现在开发环境不方便, 没法亲身体验安装, 引用<a href="http://blogs.msdn.com/dsyme/archive/2009/05/20/visual-studio-2010-beta1-with-f-is-now-available-plus-matching-f-ctp-update-for-vs2008.aspx" target="_blank" rel="external">Don</a>的一张图.<br><img src="http://blogs.msdn.com/dsyme/attachment/9632643.ashx" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/05/20/f-may-2009-ctp/" data-id="ci9p9dvxq003047jjrlio63mq" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/05/20/f-may-2009-ctp/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fsharp/">Fsharp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hide-unix-files-in-mac-os-x" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/30/hide-unix-files-in-mac-os-x/" class="article-date">
  <time datetime="2009-04-29T16:00:00.000Z" itemprop="datePublished">2009-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/30/hide-unix-files-in-mac-os-x/">Hide Unix Files in Mac OS X</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>对 bash 的极度不熟悉, 失手 rm 了 /tmp 目录.</p>
<p>理所应当的想 <code>mkdir /tmp</code> 就应该没事了吧?</p>
<p>昨天仔细看过才明白, 原来在 Mac 下面 /tmp 只是个替身(symbolic).</p>
<p>真实路径指向 /private/tmp</p>
<p>在 /private/ 下面还有我们熟悉的 etc, var 等等.</p>
<p>那么我也建立一个吧: <code>ln /tmp /private/tmp</code></p>
<p>问题来了, 怎么把这个目录在 Finder 中隐藏起来呢?</p>
<p>一阵 chmod chown … 未果…</p>
<p>今天搜索了一下 apple 论坛, 发现<a href="http://discussions.apple.com/thread.jspa?messageID=7505190" target="_blank" rel="external">这样一张贴子</a>, 顺着这张贴子找到了<a href="http://www.macosxhints.com/article.php?story=20071107023334449" target="_blank" rel="external">这样一篇文章</a>, 在文章的回复里看到<strong>那样一个办法</strong>.</p>
<p>其实很简单, 在根目录建立一个 .hidden 文件, 里边写上你不想显示的文件/目录/替身名称就好了, 例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> tmp &gt;&gt; /.hidden</span><br><span class="line">sudo <span class="built_in">echo</span> 用户手册和信息 &gt;&gt; /.hidden`</span><br></pre></td></tr></table></figure>
<p>然后注销一下就搞定了.</p>
<p>问题的解决办法好像和问题本身并不是一回事, 但是我也没有搞明白为什么论坛里提到的使用 Develop Tools 里的 SetFile 为什么就没有效果. 暂且放下完美主义吧.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/04/30/hide-unix-files-in-mac-os-x/" data-id="ci9p9dvxu003347jji0ivslhr" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/04/30/hide-unix-files-in-mac-os-x/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/">Mac</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-play-with-lighttpd--fastcgi--rails-on-leopard" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/14/play-with-lighttpd--fastcgi--rails-on-leopard/" class="article-date">
  <time datetime="2009-04-13T16:00:00.000Z" itemprop="datePublished">2009-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/14/play-with-lighttpd--fastcgi--rails-on-leopard/">Leopard 上尝试 lightTPD + FASTCGI + Rails</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>拜读<a href="http://robbin.javaeye.com/blog/155542" target="_blank" rel="external">ribbon</a>和<a href="https://docs.google.com/View?docid=ddcvzh74_28f9xppqfh" target="_blank" rel="external">ShiningRay</a>的性能分析贴, 决定在 mac 上尝试一下 lightTPD + FastCGI 这种 rails 部署方式.</p>
<p>关于如何在 Leopard 上面编译安装, 这里有两篇极为详细的教程:</p>
<p><a href="http://hivelogic.com/articles/view/ruby-rails-leopard" target="_blank" rel="external">http://hivelogic.com/articles/view/ruby-rails-leopard</a></p>
<p><a href="http://hivelogic.com/articles/view/installing-mysql-on-mac-os-x" target="_blank" rel="external">http://hivelogic.com/articles/view/installing-mysql-on-mac-os-x</a></p>
<p>同样也是从这个博主的文章中弄懂了 Unix-like 系统的目录结构, 明白了为什么要把自己编译的软件安装在/usr/local/下面. (03年就把自己闷在宿舍装 RedHat, 可是后来一直对 Unix-like 知之甚少.)</p>
<p><a href="http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" target="_blank" rel="external">http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard</a></p>
<p>有了前辈的探索, 这一路装来倒也没碰上太大的麻烦, 不过还是要注意以下几点:</p>
<p><strong>ruby1.9 和 ruby-fcgi 不合</strong>, 研究如何部署到生产环境的话, 还是不要贪玩的好.</p>
<p><strong>编译 mysql 的时候记得加 max 参数</strong>, rails 好多操作都是靠事务支持的, 所以离不开 InnoDB.</p>
<pre><code>--<span class="reserved">with</span>-plugins=max-<span class="literal">no</span>-ndb
</code></pre><hr>
<h3 id="关于下面的安装过程:">关于下面的安装过程:</h3><p>curl -O 代表下载文件, 要是你不喜欢这种方式, 也可以用别的软件来下载.</p>
<p>sudo 的前提是你得有个密码, 否则在输入密码那里直接回车是不被接受的.</p>
<hr>
<h3 id="第一步:_配置_PATH">第一步: 配置 PATH</h3><p>编辑 .profile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mate ~/.profile</span><br></pre></td></tr></table></figure>
<p>根据具体情况加入如下内容:</p>
<p>冒号分隔, 想要先查找的路径放前面, 最后那个 $PATH 代表系统原有的路径, 我们把它放到最末尾.</p>
<p>现在我们还没有这么多软件, 只是提前准备着.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/usr/local/ruby/bin:/usr/local/mysql/bin:/usr/local/lighttpd/bin:/usr/local/fcgi/bin:/usr/local/pcre/bin:/usr/local/bin:/usr/local/sbin:<span class="variable">$PATH</span>"</span></span><br></pre></td></tr></table></figure>
<p>重新加载配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ~/.profile</span><br></pre></td></tr></table></figure>
<p>OK~, 根据前文提到的博主的建议, 让我们给源码建立一个目录统一管理:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/<span class="built_in">local</span>/src</span><br><span class="line">sudo chgrp admin /usr/<span class="built_in">local</span>/src</span><br><span class="line">sudo chmod -R <span class="number">775</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第二步:_安装_Ruby">第二步: 安装 Ruby</h3><p>虽然已经内置 ruby1.8.6 了, 不过我只是想亲自试一下安装过程.</p>
<p>内存大补贴(MBARIpatch)地址有点乱, 自己下载吧.</p>
<p><a href="http://sites.google.com/site/brentsrubypatches" target="_blank" rel="external">http://sites.google.com/site/brentsrubypatches</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -O ftp://ftp.ruby-lang.org/pub/ruby/<span class="number">1.8</span>/ruby-<span class="number">1.8</span>.<span class="number">7</span>-p72.tar.gz</span><br><span class="line">tar xzvf ruby-<span class="number">1.8</span>.<span class="number">7</span>-p72</span><br><span class="line">tar xzvf MBARIp72patches.tar.gz</span><br><span class="line">MBARIp72patches/apply ruby-<span class="number">1.8</span>.<span class="number">7</span>-p72</span><br><span class="line"><span class="built_in">cd</span> ruby-<span class="number">1.8</span>.<span class="number">7</span>-p72</span><br><span class="line">./configure --typo:codefix=/usr/<span class="built_in">local</span>/ruby --enable-shared --enable-pthread CFLAGS=<span class="string">"-O2 -fno-stack-protector -D_XOPEN_SOURCE=1"</span></span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>检查一下安上了没有:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> ruby</span><br><span class="line">ruby -v</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第三步:_安装_RubyGems">第三步: 安装 RubyGems</h3><p>在你的 Mac 上面会有很多预置的 gem, 而且还 cleanup 不掉, 要是实在觉得碍眼, 可以查看一下路径, 然后重命名屏蔽掉, 但是千万别删除内置的 ruby, 否则后果很严重 (例如: textmate 失明.)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gem environment</span><br><span class="line"></span><br><span class="line">curl -O http://rubyforge.org/frs/download.php/<span class="number">45905</span>/rubygems-<span class="number">1.3</span>.<span class="number">1</span>.tgz</span><br><span class="line">tar xzvf rubygems-<span class="number">1.3</span>.<span class="number">1</span>.tgz</span><br><span class="line"><span class="built_in">cd</span> rubygems-<span class="number">1.3</span>.<span class="number">1</span></span><br><span class="line">sudo ruby setup.rb</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>gem 命令可以通过以下命令查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="built_in">help</span> commands</span><br></pre></td></tr></table></figure>
<p>命令参数是可以进行简化输入的, 只要不产生歧义. 例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem e   <span class="comment"># gem environment</span></span><br><span class="line">gem sea <span class="comment"># gem search</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第四步:_安装_Rails">第四步: 安装 Rails</h3><p>网慢是么? 把 rails 连同依赖包都下载到本地安装吧. 查看一下 rails 都依赖哪些 gem</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem dependency rails -v <span class="number">2.3</span>.<span class="number">2</span> -r</span><br></pre></td></tr></table></figure>
<p>写这些文字的时候我看到的结果是6个 (其中 rake 要求 &gt;= 0.8.3, 不过实际安装时却管我要 0.8.4, 不晓得为什么)</p>
<ul>
<li>rake (&gt;= 0.8.3, runtime)</li>
<li>activesupport (= 2.3.2, runtime)</li>
<li>activerecord (= 2.3.2, runtime)</li>
<li>actionpack (= 2.3.2, runtime)</li>
<li>actionmailer (= 2.3.2, runtime)</li>
<li>activeresource (= 2.3.2, runtime)</li>
</ul>
<p>到 <a href="http://rubyforge.org" target="_blank" rel="external">http://rubyforge.org</a> 把这些 .gem 文件都下载回来, 放在一起, 文件名不要改.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /Downloads/*.gem .</span><br><span class="line">gem install <span class="operator">-l</span> rails-<span class="number">2.3</span>.<span class="number">2</span>.gem</span><br></pre></td></tr></table></figure>
<p>速度很快吧~ 要是不安装文档会更快.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install <span class="operator">-l</span> rails-<span class="number">2.3</span>.<span class="number">2</span>.gem --no-rdoc --no-ri</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第五步:_安装_Mysql">第五步: 安装 Mysql</h3><p>网上流行的编译参数, 具体这些参数的含义, 我这个菜鸟目前还无法回答, 注意 —with-plugins=max-no-ndb</p>
<p>编译和安装的过程有点长 (加起来大约20分钟), CPU 有点热…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://mysql.mirror.tw/Downloads/MySQL-<span class="number">5.1</span>/mysql-<span class="number">5.1</span>.<span class="number">33</span>.tar.gz</span><br><span class="line">tar xzvf mysql-<span class="number">5.1</span>.<span class="number">33</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mysql-<span class="number">5.1</span>.<span class="number">33</span></span><br><span class="line">CC=gcc</span><br><span class="line">CFLAGS=<span class="string">"-O3 -fno-omit-frame-pointer"</span></span><br><span class="line">CXX=gcc</span><br><span class="line">CXXFLAGS=<span class="string">"-O3 -fno-omit-frame-pointer -felide-constructors</span><br><span class="line">-fno-exceptions -fno-rtti"</span></span><br><span class="line">./configure --typo:codefix=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">--with-extra-charsets=complex --enable-thread-safe-client</span><br><span class="line">--enable-local-infile --enable-shared --with-plugins=max-no-ndb</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>既然是 DIY, 你就得自己运行脚本填充最初的系统表.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">sudo ./bin/mysql_install_db --user=mysql</span><br><span class="line">sudo chown -R mysql ./var</span><br></pre></td></tr></table></figure>
<p>mac os x 是靠 launchd 守护进程运行的, 配置文件用的是 PropertyList (XML 格式), 通过观察发现每10秒检查一次, 发现进程不在就启动.</p>
<p>现在我们让 launchd 去看着 mysql, 保证它 7*24 都在运行.</p>
<p>方法是新建 /Library/LaunchDaemons/com.mysql.mysqld.plist 写入如下内容.</p>
<p><em>问:为什么是这个名字?</em><br>答:我看 apple 内置的文件都是这样命令的, 看起来像是 com.公司.产品.plist</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">plist</span> <span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">true</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>com.mysql.mysqld<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>Program<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>/usr/local/mysql/bin/mysqld_safe<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">true</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>UserName<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>mysql<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>WorkingDirectory<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>/usr/local/mysql<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>加入守护清单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl load -w /Library/LaunchDaemons/com.mysql.mysqld.plist</span><br></pre></td></tr></table></figure>
<p>查看清单</p>
<pre><code>launchctl <span class="type">list</span>
</code></pre><p>解除守护</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl unload -w /Library/LaunchDaemons/com.mysql.mysqld.plist</span><br></pre></td></tr></table></figure>
<p>有了自己编译的 mysql, 当然少不了那个 C 版本的 ruby 驱动.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://rubyforge.org/fsr/download.php/<span class="number">51087</span>/mysql-ruby-<span class="number">2.8</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar xzvf mysql-ruby-<span class="number">2.8</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mysql-ruby-<span class="number">2.8</span>.<span class="number">1</span></span><br><span class="line">ruby extconf.rb --with-mysql-dir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">make</span><br><span class="line">sudo make instal</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>mysql 的 make 文件比较完整, 你可以随时通过这份编译好的源码卸载掉它</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make uninstall</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第六步:_安装_FastCGI">第六步: 安装 FastCGI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://www.fastcgi.com/dist/fcgi-<span class="number">2.4</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">tar xzvf fcgi-<span class="number">2.4</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> fcgi-<span class="number">2.4</span>.<span class="number">0</span></span><br><span class="line">./configure --typo:codefix=/usr/<span class="built_in">local</span>/fcgi</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"> </span><br><span class="line">curl -O http://rubyforge.org/fsr/download.php/<span class="number">11368</span>/ruby-fcgi-<span class="number">0.8</span>.<span class="number">7</span>.tar.gz</span><br><span class="line">tar xzvf ruby-fcgi-<span class="number">0.8</span>.<span class="number">7</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> ruby-fcgi-<span class="number">0.8</span>.<span class="number">7</span></span><br><span class="line">sudo ruby install.rb config -- --with-fcgi-include=/usr/<span class="built_in">local</span>/fcgi/include --with-fcgi-lib=/usr/<span class="built_in">local</span>/fcgi/lib</span><br><span class="line">ruby install.rb setup</span><br><span class="line">sudo ruby install.rb install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="第七步:_安装_lightTPD">第七步: 安装 lightTPD</h3><p>ribbon 的文章里告诫我们要先装 PCRE, 我们不要去怀疑:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -O ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-<span class="number">7.8</span>.tar.gz</span><br><span class="line">tar xzvf pcre-<span class="number">7.8</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pcre-<span class="number">7.8</span></span><br><span class="line">CFLAGS=<span class="string">'-O2 -Wall'</span></span><br><span class="line">./configure --typo:codefix=/usr/<span class="built_in">local</span>/pcre</span><br><span class="line">make</span><br><span class="line">sudo make instal</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>有了前辈经验作为铺垫, 安装倒也简单:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://www.lighttpd.net/download/lighttpd-<span class="number">1.4</span>.<span class="number">22</span>.tar.gz</span><br><span class="line">tar xzvf lighttpd-<span class="number">1.4</span>.<span class="number">22</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lighttpd-<span class="number">1.4</span>.<span class="number">22</span></span><br><span class="line">./configure --typo:codefix=/usr/<span class="built_in">local</span>/lighttpd --with-pcre=/usr/<span class="built_in">local</span>/pcre</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>
<p>把默认配置文件复制出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ./doc/lighttpd.conf /etc/lighttpd.conf</span><br></pre></td></tr></table></figure>
<p>至于怎么配置, 有点超出我的能力范围了, 我只能勉强让它跑起来. 我只改动了下面几处:</p>
<ul>
<li>开几个模块 mod_  rewrite access fastcgi simple_vhost cgi comtypo:codess accesslog</li>
<li>指定路径的时候不能用 ~/ 这样的路径</li>
<li>指定日志 accesslog.filename = “/var/log/lighttpd/access.log”, 这里的路径不是硬性规定,  但是记得如果没有这个目录的话要先创建.  </li>
</ul>
<p>lighttpd 配置:</p>
<pre><code>$HTTP[<span class="string">"host"</span>] =~ <span class="string">".+"</span> {
    server.<span class="built_in">document</span>-root = <span class="string">"/Users/colder/Sites/rails/public"</span>
    server.error-handler-<span class="number">404</span> = <span class="string">"/dispatch.fcgi"</span>
    fastcgi.server = (<span class="string">".fcgi"</span> =&gt;
        ( <span class="string">"localhost"</span> =&gt;
            ( <span class="string">"min-procs"</span> =&gt; <span class="number">3</span>,
                <span class="string">"max-procs"</span> =&gt; <span class="number">3</span>,
                <span class="string">"socket"</span> =&gt; <span class="string">"/tmp/rails.socket"</span>,
                <span class="string">"bin-path"</span> =&gt; <span class="string">"/Users/colder/Sites/rails/public/dispatch.fcgi"</span>,
                <span class="string">"bin-environment"</span> =&gt; (<span class="string">"RAILS_ENV"</span> =&gt; <span class="string">"development"</span>)
            )
        )
    )
}
</code></pre><p>launchd 的配置过程和 mysql 相似, 但也有点特殊. 从这份文件中可以看出如果守护的程序是带参数的, 那么第一个参数必须是程序本身. 参数名与参数值之前还不能留空格.<br>新建 /Library/LaunchDaemons/com.lighttpd.lighttpd.plist 写入如下内容:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">plist</span> <span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">true</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 这就是个名字, 会显示在 launchctl list 里看到. --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>lighttpd<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>OnDemand<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">false</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>Program<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">string</span>&gt;</span>/usr/local/lighttpd/sbin/lighttpd<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>/usr/local/lighttpd/sbin/lighttpd<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这行很奇怪是吧? -f 后面紧挨着参数值, 你要不这样写, 就甭想启动. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>-f/etc/lighttpd.conf<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">string</span>&gt;</span>-D<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">true</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后加载这个文件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl load -w /Library/LaunchDaemons/com.lighttpd.lighttpd.plist</span><br></pre></td></tr></table></figure>
<hr>
<p>有了 launchd, mysql 和 lighttpd 的运行基本上不用担心了, 那 rails 的运行靠谁呢? 答案是 lighttpd. 配置文件说明了这一点, 当 lighttpd 启动的时候, 它会启动若干个 rails 实例 (数量由 min-procs 和 max-procs 决定). 即使是中途手动杀掉了 ruby 进程, 只要有请求进来, lighttpd 还是会去启动 rails 实例进行响应的.</p>
<p>OK~ 如果人品没有什么大问题的话, 到这里应该已经跑起来了, 这也正应了 rails 官方的那句台词:”先跑起来再说!”</p>
<p>如果跑不起来呢? 嗯! 我就碰到了下面的这个问题: 在 Windows 创建的 rails 项目, 复制到 Mac 上面就跑不起来了. 碰到这种情况, 看看你的rails目录下面的 public/dispatch.fcgi 开头第一句, 如果类似于: #!C:/Ruby/bin 这样的话, 请竖起中指!</p>
<p>然后心平气和的改成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/ruby/bin/ruby</span></span><br></pre></td></tr></table></figure>
<p>还有, 不要可惜了你的 Mac, 她不只有个光鲜的外表, 里边也很有内涵, 例如 tail</p>
<p>想知道 lighttpd 为什么启动不了的时候可以用它查看错误日志, 然后再一边修改配置, 一边回来查看这10秒一次的新日志.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail <span class="operator">-f</span> /var/<span class="built_in">log</span>/lighttpd/error.log</span><br></pre></td></tr></table></figure>
<p>当然, 用在 rails 开发的时候会更合适:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail <span class="operator">-f</span> ~/Sites/rails/<span class="built_in">log</span>/development.log</span><br></pre></td></tr></table></figure>
<p>经过这一番折腾, Rails 开发环境总算是跑起来了.</p>
<p>不是部署环境么?</p>
<p>呃. 就我目前的水平, 还不敢谈部署, 只想着用 ribbon 推荐的部署环境进行开发, 就已经满意了, 至于什么时候谈部署, 还得慢慢来, 现在水平还太烂, 深入学习 *nix 和 rails 才一个月, 不敢奢望太多.</p>
<p>至少目前很多问题还不好解决, 例如:</p>
<p>不知道为什么后端有时候会死掉, 而且 lighttpd 又不会去重开. (手动杀的就可以重开).</p>
<p>偶尔还会出现连接失败(开发环境, 小量请求).</p>
<p>好吧~ 世上没有十全十美, 不是么?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/04/14/play-with-lighttpd--fastcgi--rails-on-leopard/" data-id="ci9p9dvxx003547jjl9okqiw4" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/04/14/play-with-lighttpd--fastcgi--rails-on-leopard/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rails/">Rails</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-rails-evial--april-fools-days" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/01/rails-evial--april-fools-days/" class="article-date">
  <time datetime="2009-03-31T16:00:00.000Z" itemprop="datePublished">2009-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/01/rails-evial--april-fools-days/">Rails Ev(i|a)l @ April Fools Days</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>First. Create a evil, oh no, a eval controller.</p>
<p>app/controllers/ruby_eval_controller.rb</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Class</span> <span class="constant">RubyEvalController</span> &lt; <span class="constant">ApplicationController</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> </span><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">@result</span> = eval(params[<span class="symbol">:ruby</span>])</span><br><span class="line">      render <span class="symbol">:xml</span> =&gt; <span class="variable">@result</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      head <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Then. Let’s post some evil params.</p>
<p>POST /ruby_eval</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">ruby</span>&gt;</span>User.find_by_intro('I am eval or evil?')<span class="tag">&lt;/<span class="title">ruby</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/04/01/rails-evial--april-fools-days/" data-id="ci9p9dvy4003a47jj3kds7jbg" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/04/01/rails-evial--april-fools-days/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rails/">Rails</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-understand-nix-folder" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/01/understand-nix-folder/" class="article-date">
  <time datetime="2009-03-31T16:00:00.000Z" itemprop="datePublished">2009-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/01/understand-nix-folder/">弄懂 *Nix 文件夹</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一直以来对类 Unix 系统都没有太深入的研究过, 许多问题不求甚解.</p>
<p>例如这个关于文件系统目录结构的问题:</p>
<ul>
<li><p>/bin 和 /sbin 的区别是什么?</p>
</li>
<li><p>/bin 和 /usr/bin 有什么区别?</p>
</li>
<li><p>/lib 和 /var/lib 又有什么区别?</p>
</li>
</ul>
<p>更奇怪的是为什么 /usr/local 里面又有一套 bin lib?</p>
<p>今天无意间在 <a href="http://hivelogic.com/articles/view/using_usr_local" target="_blank" rel="external">hivelogic</a> 的博客里找到了答案:</p>
<p><a href="http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" target="_blank" rel="external">http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard</a></p>
<p>以下标准不是硬性的, 也就是说每个变种都或多或少的有所违背, 但总体上还是保持尊重.</p>
<ul>
<li><p>/                     根目录, 文件体系的入口.</p>
</li>
<li><p>/home                 用户自己的根目录.</p>
</li>
<li><p>/root                 root 帐户的 home.</p>
</li>
<li><p>/bin                  binary 单用户模式必需的可执行文件, 也就是所有用户都要用到的.</p>
</li>
<li><p>/sbin                 system binary 系统必需的可执行文件.</p>
</li>
<li><p>/lib                  library 一些库文件, 供 /bin 和 /sbin 使用.</p>
</li>
<li><p>/etc                  存放系统级别的配置文件. (<em><a href="http://en.wikipedia.org/wiki/Et_cetera" target="_blank" rel="external">et cetera</a> 其他, 等等… 貌似是法文</em>)</p>
</li>
<li><p>/boot                 启动和初始化所需的文件.</p>
</li>
<li><p>/dev                  device 设备. 在 *nix 的概念中, 设备也是文件.</p>
</li>
<li><p>/media                可移动媒介安置点, 例如光驱和U盘.</p>
</li>
<li><p>/mnt                  文件系统临时安置点. (<em>不清楚和上一个的区别</em>)</p>
</li>
<li><p>/opt                  optional 可选的应用程序软件包.</p>
</li>
<li><p>/tmp                  temp 临时文件, 重启消失.</p>
</li>
<li><p>/usr                  user 文件体系的第二级, 存放多用户应用程序,</p>
</li>
<li><p>/usr/local            文件体系的第三级. 在这里编译安装软件对系统的影响最小.</p>
</li>
<li><p>/var                  variable 易变的文件. 日志, 打印, 邮件等.</p>
</li>
</ul>
<p>其中 /bin /usr/bin 和 /usr/local/bin 实际上是代表了三个阶层, 第一阶层所有用户通用, 第二阶层可以针对每个用户不同, 第三个阶层是用户之间相对独立的.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/04/01/understand-nix-folder/" data-id="ci9p9dvy1003847jjt94gkpz5" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/04/01/understand-nix-folder/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/">Mac</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flex-put-xml-to-rails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/03/22/flex-put-xml-to-rails/" class="article-date">
  <time datetime="2009-03-21T16:00:00.000Z" itemprop="datePublished">2009-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/03/22/flex-put-xml-to-rails/">Flex 提交 Xml 到 Rails</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>如何从 Flex3.2 调用 Rails2.3.2 的 Restful API?</p>
<p>所谓 Restful API, 简单的说就是利用已有的四个 HTTP 动作实现对资源的四种操作:</p>
<ul>
<li>GET 获取</li>
<li>POST 创建</li>
<li>PUT 更新</li>
<li>DELETE 删除</li>
</ul>
<p>在这里对 REST 不作更详尽的解释, 相关资料网上有很多, 争议更多. 我们暂且不管这些争论(包括作者自己也在争论), 单从纯技术角度来看, 这种方式对于我们常见的 CRUD 操作实在是再方便不过了.</p>
<p>但是且慢, 如果你拥有一个独立的客户端, 发送这四种动作是不成问题的, 可是如果你是做 RIA 开发(Flex 或 Silverlight), 目前的浏览器宿主只能支持 GET 和 POST. 后两种动作怎么办?</p>
<p><em>注: 虽然 Flex 里的 HTTPService 组件有8种动作, 但并不起作用.</em></p>
<p>也许你已经见过很多动态网站系统采用的解决办法了, 那就是加 URL 参数.</p>
<pre><code><span class="string">http:</span><span class="comment">//www.example.com/admin.asp?action=newpost&amp;title=abc</span>
</code></pre><p>这样做的好处是通过直观的参数与服务器进行对话.</p>
<p>当然坏处也不少, 按照 HTTP 协议, GET 动作是不能对服务器有副作用的, 因为 GET 只负责读取, 另外这样的 URL 如果被搜索引擎收录了, 或者被用户加入收藏夹, 虽然不是什么致命的问题, 但终究还是对 HTTP 协议的一种误读.</p>
<p>OK~, 既然浏览器不支持, 提倡 Restful 的框架又普遍不满意这种 URL 参数的工作方式, 那 rails 是如何解决这个问题的呢?</p>
<p>Rails 也没有能力解决浏览器的问题, 她同样需要使用额外的方法来模拟 PUT 和 DELETE 动作, 查看产生的源代码, 你会发现她采用的方法是读取 POST 表单里的 hidden 域 _method</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"_method"</span> <span class="attribute">type</span>=<span class="value">"hidden"</span> <span class="attribute">value</span>=<span class="value">"put"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>采用这种办法对于网页的表单来说或许是合适的, 但对于像我这样使用 Flex 开发 RIA 客户端程序的人来说, 会存在下面的问题:</p>
<p>我读取的文档可能是这样的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">user</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>路飞<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">age</span>&gt;</span>20<span class="tag">&lt;/<span class="title">age</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">user</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么我为什么要转换成类似下面的表单来提交?</p>
<pre><code><span class="built_ins">user</span>[name]=路飞&amp;<span class="built_ins">user</span>[age]=20
</code></pre><p>如果可以读取也是 xml, 提交亦是 xml, 生活就简单的多了, 不是么?</p>
<p>提交 xml 就意味着 _method 必须放在别的地方(xml 是不能有两个根元素的), rails 2.2.2 之前的版本(具体到哪一版并不清楚), 服务器是接受 GET 参数的, 也就是说可以写成这样:</p>
<pre><code><span class="attribute">/users/1?_method</span>=<span class="string">PUT</span>
</code></pre><p>_method 虽然有了安身之处, 但是且慢! 这样安全吗? 正规吗? 我想 rails 的开发者也对这个东西看不顺眼, 所以在 rails 2.3.2 里, 这种方法被禁止了.</p>
<p>详见:</p>
<blockquote>
<p>lib/action_controller/vendor/rack-1.0/rack/methodoverride.rb</p>
</blockquote>
<p>新版本只在 POST 表单里读取 _method, My God…</p>
<p>幸运的是, methodoverride.rb 这个文件的内容为我指明了另一个方向:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> </span>call(env)</span><br><span class="line">  <span class="keyword">if</span> env[<span class="string">"REQUEST_METHOD"</span>] == <span class="string">"POST"</span></span><br><span class="line">    req = <span class="constant">Request</span>.new(env)</span><br><span class="line">    method = req.<span class="constant">POST</span>[<span class="constant">METHOD_OVERRIDE_PARAM_KEY</span>] ||</span><br><span class="line">      env[<span class="constant">HTTP_METHOD_OVERRIDE_HEADER</span>]</span><br><span class="line">    method = method.to_s.upcase</span><br><span class="line">    <span class="keyword">if</span> <span class="constant">HTTP_METHODS</span>.<span class="keyword">include</span>?(method)</span><br><span class="line">      env[<span class="string">"rack.methodoverride.original_method"</span>] = env[<span class="string">"REQUEST_METHOD"</span>]</span><br><span class="line">      env[<span class="string">"REQUEST_METHOD"</span>] = method</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>这个文件告诉我们, 服务器除了接受 _method 隐藏域之外, 还接受一个叫 “HTTP_X_HTTP_METHOD_OVERRIDE” 的消息头, 太棒了, 让我们迎着光明继续前进~</p>
<p>为了能够看到提交的消息头, 我们需要在 application_controller.rb 里添加点代码. (Rails 2.2.2 之前该文件名为 application.rb)</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationController</span> <span class="inheritance">&lt; <span class="parent">ActionController::Base</span></span></span></span><br><span class="line">  before_filter <span class="symbol">:print_headers</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> </span>print_headers</span><br><span class="line">    request.headers.each &#123; |k,v| logger.info(<span class="string">"<span class="subst">#&#123;k&#125;</span> <span class="subst">#&#123;v&#125;</span>"</span>) &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>现在回到 Flex 我们创建一个客户端试验一下效果.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> svc:HTTPService = <span class="keyword">new</span> HTTPService();</span><br><span class="line">svc.method = <span class="string">"POST"</span>;</span><br><span class="line">svc.url = <span class="string">"/users/1"</span>;</span><br><span class="line">svc.headers = &#123; HTTP_X_HTTP_METHOD_OVERRIDE:<span class="string">"PUT"</span>, Accept:<span class="string">"application/xml"</span> &#125;;</span><br><span class="line">svc.request = &#123; user:&#123; age:<span class="number">30</span> &#125; &#125;;</span><br><span class="line">svc.send();</span><br></pre></td></tr></table></figure>
<p>结果有点长, 删减之后你会发现类似下面这样的内容:</p>
<pre><code>Processing UsersController#<span class="operator"><span class="keyword">create</span> <span class="keyword">to</span> <span class="keyword">xml</span> (<span class="keyword">for</span> <span class="number">127.0</span>.0.1 <span class="keyword">at</span> <span class="number">2009</span>-<span class="number">03</span>-<span class="number">22</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">04</span>) [POST]
HTTP_HTTP_X_HTTP_METHOD_OVERRIDE PUT</span>
</code></pre><p>呃… 为什么会多出个 HTTP_ 前缀来呢? 这个问题留给你来解答吧, 我也实在是说不清楚.</p>
<p>不过没关系, 问题已经明朗了, 重新设计一下我们的消息头就可以了.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先创建服务代理, 这里只是个例子, 实例上你可能更喜欢用 Mxml.</span></span><br><span class="line"><span class="keyword">var</span> svc:HTTPService = <span class="keyword">new</span> HTTPService();</span><br><span class="line"><span class="comment">// 只能是 POST, 不要被其他那些参数给骗了.</span></span><br><span class="line">svc.method = <span class="string">"POST"</span>;</span><br><span class="line"><span class="comment">// 朝用户 ID 为 1 的资源发出 PUT 动作</span></span><br><span class="line">svc.url = <span class="string">"/users/1"</span>;</span><br><span class="line"><span class="comment">// 既然不知道哪里来了个 HTTP_ 前缀, 那我们就少打5个字母好了.</span></span><br><span class="line"><span class="comment">// Accept 消息头可以使我们的 url 不必以 .xml 结尾来说明 format.</span></span><br><span class="line">svc.headers = &#123; X_HTTP_METHOD_OVERRIDE:<span class="string">"PUT"</span>, Accept:<span class="string">"application/xml"</span> &#125;;</span><br><span class="line"><span class="comment">// 请求的内容是你想要更新的字段, 这里视情况而定, 也可以直接写 xml.</span></span><br><span class="line">svc.request = &#123; user:&#123; age:<span class="number">30</span> &#125; &#125;;</span><br><span class="line"><span class="comment">// 发射!!!</span></span><br><span class="line">svc.send();</span><br></pre></td></tr></table></figure>
<p>结果:</p>
<pre><code>Processing UsersController#<span class="operator"><span class="keyword">update</span> <span class="keyword">to</span> <span class="keyword">xml</span> (<span class="keyword">for</span> <span class="number">127.0</span>.0.1 <span class="keyword">at</span> <span class="number">2009</span>-<span class="number">03</span>-<span class="number">22</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">13</span>) [PUT]
Parameters: {<span class="string">"id"</span>=&gt;<span class="string">"1"</span>}
.......
HTTP_X_HTTP_METHOD_OVERRIDE PUT
.......
    <span class="keyword">User</span> <span class="keyword">Load</span> (<span class="number">0.0</span>ms) <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">"users"</span> <span class="keyword">WHERE</span> (<span class="string">"users"</span>.<span class="string">"id"</span> = <span class="number">1</span>)
    <span class="keyword">User</span> <span class="keyword">Update</span> (<span class="number">2.0</span>ms) <span class="keyword">UPDATE</span> <span class="string">"users"</span> <span class="keyword">SET</span> <span class="string">"age"</span> = <span class="number">30</span>, <span class="string">"updated_at"</span> = <span class="string">'2009-03-22 03:05:13'</span> <span class="keyword">WHERE</span> <span class="string">"id"</span> = <span class="number">1</span>
Completed <span class="keyword">in</span> <span class="number">164</span>ms (<span class="keyword">View</span>: <span class="number">4</span>, DB: <span class="number">2</span>) | <span class="number">200</span> OK [http://<span class="number">192.168</span>.0.1/users/<span class="number">1</span>]</span>
</code></pre><p>OK~ 看来 Rails 已经收到我们的信号, 并且正确识别了我们想要的动作 PUT. 其他类似的动作可以由我们自由发挥了, 再也不用受 _method 的牵拌.</p>
<p>嗯, 如果你也是一个像我一样的在技术领域无聊的完美主义者, 但愿这个结果能够令你满意.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.vitarn.com/2009/03/22/flex-put-xml-to-rails/" data-id="ci9p9dvy7003c47jjhschk5m2" class="article-share-link">Share</a>
      
        <a href="http://blog.vitarn.com/2009/03/22/flex-put-xml-to-rails/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flash/">Flash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rails/">Rails</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Air/" style="font-size: 10px;">Air</a><a href="/tags/Apple/" style="font-size: 12.22px;">Apple</a><a href="/tags/AutoCAD/" style="font-size: 17.78px;">AutoCAD</a><a href="/tags/Chrome/" style="font-size: 11.11px;">Chrome</a><a href="/tags/Cordova-Phaser-iOS-Android/" style="font-size: 11.11px;">Cordova Phaser iOS Android</a><a href="/tags/Csharp/" style="font-size: 10px;">Csharp</a><a href="/tags/Firefox/" style="font-size: 13.33px;">Firefox</a><a href="/tags/Flash/" style="font-size: 11.11px;">Flash</a><a href="/tags/Fsharp/" style="font-size: 20px;">Fsharp</a><a href="/tags/Game/" style="font-size: 15.56px;">Game</a><a href="/tags/Github/" style="font-size: 10px;">Github</a><a href="/tags/Google/" style="font-size: 15.56px;">Google</a><a href="/tags/Heroku/" style="font-size: 10px;">Heroku</a><a href="/tags/IE/" style="font-size: 10px;">IE</a><a href="/tags/Jekyll/" style="font-size: 10px;">Jekyll</a><a href="/tags/LISP/" style="font-size: 16.67px;">LISP</a><a href="/tags/Mac/" style="font-size: 18.89px;">Mac</a><a href="/tags/Movie/" style="font-size: 12.22px;">Movie</a><a href="/tags/MySQL/" style="font-size: 12.22px;">MySQL</a><a href="/tags/Objc/" style="font-size: 10px;">Objc</a><a href="/tags/Rails/" style="font-size: 13.33px;">Rails</a><a href="/tags/Ruby/" style="font-size: 14.44px;">Ruby</a><a href="/tags/SQLite/" style="font-size: 11.11px;">SQLite</a><a href="/tags/SVN/" style="font-size: 10px;">SVN</a><a href="/tags/Safari/" style="font-size: 11.11px;">Safari</a><a href="/tags/Server/" style="font-size: 11.11px;">Server</a><a href="/tags/Silverlight/" style="font-size: 17.78px;">Silverlight</a><a href="/tags/Textmate/" style="font-size: 10px;">Textmate</a><a href="/tags/Toto/" style="font-size: 10px;">Toto</a><a href="/tags/WCF/" style="font-size: 14.44px;">WCF</a><a href="/tags/Wikipedia/" style="font-size: 11.11px;">Wikipedia</a><a href="/tags/Wordpress/" style="font-size: 12.22px;">Wordpress</a><a href="/tags/Workpress/" style="font-size: 10px;">Workpress</a><a href="/tags/iPhone/" style="font-size: 10px;">iPhone</a><a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">七月 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">六月 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">八月 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">七月 2010</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">六月 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">五月 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">四月 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">八月 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">七月 2009</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/06/">六月 2009</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">五月 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">四月 2009</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">三月 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/02/">二月 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/01/">一月 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/12/">十二月 2008</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/11/">十一月 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">十月 2008</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/09/">九月 2008</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/08/">八月 2008</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/07/">七月 2008</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">六月 2008</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">五月 2008</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/04/">四月 2008</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/03/">三月 2008</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">一月 2008</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/12/">十二月 2007</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/11/">十一月 2007</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/10/">十月 2007</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/09/">九月 2007</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/06/">六月 2007</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/05/">五月 2007</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/04/">四月 2007</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/15/cordova-phaser-simple-app-develop-note-2/">Cordova+Phaser 简易APP开发日记(二)</a>
          </li>
        
          <li>
            <a href="/2015/05/15/cordova-phaser-simple-app-develop-note-1/">Cordova+Phaser 简易APP开发日记(一)</a>
          </li>
        
          <li>
            <a href="/2012/03/22/macbook-466-467-ssd/">MacBook 466/467 固态硬盘</a>
          </li>
        
          <li>
            <a href="/2011/09/09/thunder-for-mac-with-gougou-search/">迅雷 for Mac 夹带狗狗搜索</a>
          </li>
        
          <li>
            <a href="/2011/07/18/ruby-koans/">Ruby Koans</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Colder<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/googlessl" class="mobile-nav-link">GoogleSSL</a>
  
    <a href="/lookuptower" class="mobile-nav-link">LookupTower</a>
  
</nav>
    
<script>
  var disqus_shortname = 'vitarn';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.js" type="text/javascript"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>